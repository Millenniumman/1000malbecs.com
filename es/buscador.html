<!DOCTYPE html>
<html lang="es" x-data="wineSearch" x-init="init()">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="Busca los mejores Malbecs de Argentina por provincia, región, bodega y más." name="description"/>
    <title>1000malbecs - Buscador de Vinos</title>
    <meta content="Buscador de los mejores Malbecs argentinos, desde Patagonia hasta Puna" property="og:title"/>
    <meta content="Explora y filtra nuestra selección de Malbecs por provincia, región, bodega, año y variedad." property="og:description"/>
    <meta content="https://www.1000malbecs.com/images/1000-malbecs-logo.png" property="og:image"/>
    <meta content="image/png" property="og:image:type"/>
    <meta content="1200" property="og:image:width"/>
    <meta content="630" property="og:image:height"/>
    <meta content="https://www.1000malbecs.com/es/buscador.html" property="og:url"/>
    <meta content="website" property="og:type"/>
    <meta content="summary_large_image" name="twitter:card"/>
    <meta content="1000 Malbecs - Buscador de Vinos" name="twitter:title"/>
    <meta content="Filtra y descubre los mejores Malbecs argentinos." name="twitter:description"/>
    <meta content="https://www.1000malbecs.com/images/1000-malbecs-logo.png" name="twitter:image"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>
    <link href="/css/styles.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.9/dist/cdn.min.js" defer></script>
    <script src="/js/wine-search.js" defer></script>
    <script src="/js/global.js" defer></script>
    <style>
        body { font-family: 'Montserrat', sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; min-height: 100vh; }
        .main-content { flex: 1; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .hamburger { display: none; font-size: 24px; background: none; border: none; color: #4A2C59; cursor: pointer; padding: 10px; position: fixed; top: 15px; left: 10px; z-index: 130; }
        #sidebar { width: 250px; background-color: #F8F8F8; padding: 20px; height: 100vh; position: fixed; top: 0; left: 0; overflow-y: auto; border-right: 1px solid #E0E0E0; z-index: 100; transition: transform 0.3s ease; }
        .logo-container { text-align: center; margin-bottom: 20px; }
        .logo { max-width: 150px; height: auto; }
        #sidebar details { margin: 10px 0; }
        #sidebar summary { cursor: pointer; font-weight: bold; padding: 10px; }
        #sidebar ul { list-style: none; padding: 0; margin: 0; }
        #sidebar ul li { margin: 5px 0; }
        #sidebar ul li a { text-decoration: none; color: #333; }
        #sidebar ul li a.active { font-weight: bold; }
        main { margin-left: 290px; padding: 20px; width: calc(100% - 290px); }
        main h1 { font-size: 24px; color: #4A2C59; margin-bottom: 20px; }
        .section-title { font-size: 22px; color: #4A2C59; margin: 20px 0 10px; text-align: center; text-transform: uppercase; }
        .product-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 30px; margin-bottom: 30px; width: 100%; justify-content: start; }
        .product-card { background-color: #FFFFFF; border: 1px solid #E0E0E0; border-radius: 5px; padding: 15px; padding-bottom: 20px; position: relative; overflow: visible; max-width: 250px; min-height: 360px; display: flex; flex-direction: column; justify-content: space-between; align-items: center; z-index: 5; box-shadow: 0 2px 5px rgba(0,0,0,0.1); box-sizing: border-box; width: 100%; }
        .product-card img { width: 200px; height: 200px; object-fit: contain; margin: 0 auto; }
        .info-icon { position: absolute; top: 10px; right: 10px; font-size: 20px; cursor: pointer; z-index: 10; display: none; color: #4A2C59; background-color: rgba(255, 255, 255, 0.8); border-radius: 50%; width: 40px; height: 40px; line-height: 40px; text-align: center; touch-action: manipulation; pointer-events: auto; }
        .overlay { display: none; position: absolute; top: 0; left: 0; width: 100%; max-height: 150px; background-color: rgba(74, 44, 89, 0.8); color: #FFFFFF; padding: 40px 10px 10px 10px; box-sizing: border-box; font-size: 12px; overflow-y: auto; z-index: 6; pointer-events: none; }
        .overlay p { margin: 2px 0; color: #FFFFFF; text-align: left; }
        .product-card:hover .overlay { display: block; }
        .product-card .overlay.active { display: block !important; }
        .product-card h3 { font-size: 16px; margin: 10px 0; color: #4A2C59; min-height: 40px; overflow: hidden; text-overflow: ellipsis; white-space: normal; text-align: center; width: 100%; }
        .product-card .price { font-size: 16px; color: #4A2C59; margin: 10px 0; position: relative; z-index: 7; text-align: center; width: 100%; }
        .product-card .buy-button { padding: 8px 16px; font-size: 14px; margin-top: 10px; margin-bottom: 15px; position: relative; z-index: 7; text-align: center; background-color: #4A2C59; color: #f5e6ff; text-decoration: none; border-radius: 5px; pointer-events: auto; width: 100%; max-width: 180px; display: block; }
        .product-card .buy-button:hover { background-color: #5A1D39; }
        .filters { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .filters select { padding: 8px; border: 1px solid #E0E0E0; border-radius: 5px; width: 200px; }
        .filters button { background-color: #4A2C59; color: #f5e6ff; padding: 8px 16px; border-radius: 5px; border: none; cursor: pointer; }
        .language-selector { display: flex; gap: 10px; position: fixed; top: 10px; right: 10px; z-index: 1000; margin: 10px; justify-content: flex-end; }
        .language-selector select { padding: 5px; border: 1px solid #ccc; border-radius: 4px; }
        footer { background: #333; color: #fff; padding: 20px; text-align: center; }
        .footer-content { display: flex; flex-wrap: wrap; justify-content: space-around; }
        .footer-contact, .footer-social { margin: 10px; }
        .icon-text { display: inline-flex; align-items: center; gap: 5px; color: #fff; }
        .separator { margin: 0 10px; }
        .error-message { color: red; text-align: center; margin: 20px 0; }
        @media (max-width: 768px) {
            main { margin-left: 0; margin-top: 60px; padding: 10px; width: 100%; }
            .hamburger { display: block !important; z-index: 130; }
            #sidebar { width: 100%; height: 100vh; position: fixed; top: 0; left: 0; transform: translateX(-100%); z-index: 100; border-bottom: 1px solid #E0E0E0; padding-top: 50px; padding-bottom: 20px; overflow-y: auto; box-sizing: border-box; }
            #sidebar.open { transform: translateX(0); }
            .logo-container { display: none; }
            .product-grid { grid-template-columns: repeat(2, 1fr); gap: 15px; justify-content: start; }
            .product-card { width: 100%; max-width: none; height: 260px; min-height: auto; padding: 10px; box-sizing: border-box; overflow: hidden; position: relative; align-items: center; }
            .product-card img { width: 140px; height: 140px; margin: 0 auto; }
            .product-card h3 { font-size: 14px; min-height: 36px; margin: 5px 0; text-align: center; width: 100%; }
            .product-card .price { font-size: 14px; margin: 5px 0; text-align: center; width: 100%; }
            .product-card .buy-button { padding: 6px 12px; font-size: 12px; margin-top: 5px; margin-bottom: 5px; pointer-events: auto; width: 100%; max-width: 140px; display: block; }
            .info-icon { display: block !important; pointer-events: auto; z-index: 10; }
            .overlay { max-height: 150px; pointer-events: auto; width: 100%; box-sizing: border-box; top: 0; padding: 40px 10px 10px 10px; display: none; z-index: 6; }
            .overlay.active { display: block !important; z-index: 6; }
            .product-card:hover .overlay { display: none; }
            .language-selector { position: static; width: 100%; text-align: center; margin: 10px 0; z-index: 1000; max-width: 100%; overflow: visible; }
            .filters select { width: 100%; max-width: 150px; }
        }
        @media (min-width: 769px) {
            .hamburger { display: none; }
            .logo-container { display: block; }
            .info-icon { display: none; }
            .product-grid { grid-template-columns: repeat(4, 1fr); gap: 30px; max-width: 1200px; justify-content: start; }
            .product-card { pointer-events: auto; max-width: 250px; min-height: 360px; width: 100%; padding: 15px; display: flex; flex-direction: column; justify-content: space-between; align-items: center; box-sizing: border-box; }
            .product-card img { width: 200px; height: 200px; margin: 0 auto; }
        }
    </style>
</head>
<body>
    <button class="hamburger" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
    <nav id="sidebar"></nav>
    <div class="main-content">
        <main class="container">
            <h1 x-text="translations[lang].title"></h1>
            <div class="language-selector">
                <label for="lang-select" class="sr-only" x-text="translations[lang].selectLanguage"></label>
                <select id="lang-select" x-model="lang" @change="changeLanguage()">
                    <option value="es">Español</option>
                    <option value="en">English</option>
                    <option value="de">Deutsch</option>
                </select>
            </div>
            <form @submit.prevent="searchWines()">
                <label for="searchQuery" class="sr-only" x-text="translations[lang].searchPlaceholder"></label>
                <input type="text" id="searchQuery" x-model="searchQuery" :placeholder="translations[lang].searchPlaceholder">
                <div class="filters">
                    <select x-model="filters.Provincia" :placeholder="translations[lang].provincia">
                        <option value="">{{ translations[lang].allProvincias }}</option>
                        <template x-for="provincia in uniqueProvincias" :key="provincia">
                            <option :value="provincia" x-text="provincia"></option>
                        </template>
                    </select>
                    <select x-model="filters.Región" :placeholder="translations[lang].region">
                        <option value="">{{ translations[lang].allRegions }}</option>
                        <template x-for="region in uniqueRegions" :key="region">
                            <option :value="region" x-text="region"></option>
                        </template>
                    </select>
                    <select x-model="filters.Bodega" :placeholder="translations[lang].bodega">
                        <option value="">{{ translations[lang].allBodegas }}</option>
                        <template x-for="bodega in uniqueBodegas" :key="bodega">
                            <option :value="bodega" x-text="bodega"></option>
                        </template>
                    </select>
                    <select x-model="filters.Año" :placeholder="translations[lang].anada">
                        <option value="">{{ translations[lang].allAnadas }}</option>
                        <template x-for="anada in uniqueAnadas" :key="anada">
                            <option :value="anada" x-text="anada"></option>
                        </template>
                    </select>
                    <select x-model="filters.Altura" :placeholder="translations[lang].altura">
                        <option value="">{{ translations[lang].allAlturas }}</option>
                        <template x-for="altura in uniqueAlturas" :key="altura">
                            <option :value="altura" x-text="altura + ' msnm'"></option>
                        </template>
                    </select>
                    <select x-model="filters.Variedad" :placeholder="translations[lang].variedad">
                        <option value="">{{ translations[lang].allVariedades }}</option>
                        <template x-for="variedad in uniqueVariedades" :key="variedad">
                            <option :value="variedad" x-text="variedad"></option>
                        </template>
                    </select>
                    <button type="submit" x-text="translations[lang].searchButton"></button>
                    <button type="button" @click="clearFilters()" x-text="translations[lang].clearFilters"></button>
                </div>
            </form>
            <div class="results" x-show="showResults">
                <h3 class="section-title" x-text="translations[lang].ourWines"></h3>
                <div class="product-grid">
                    <template x-for="wine in filteredWines" :key="wine.sku">
                        <div class="product-card">
                            <img :src="wine.Imagen" :alt="wine.Nombre" :onerror="this.src='https://via.placeholder.com/200x200?text=Image+Not+Available';" />
                            <i class="fas fa-info-circle info-icon" @click="toggleOverlay($el.parentNode.querySelector('.overlay'))"></i>
                            <div class="overlay">
                                <p x-text="`${translations[lang].bodega}: ${wine.Bodega}`"></p>
                                <p x-text="`${translations[lang].provincia}: ${wine.Provincia}`"></p>
                                <p x-text="`${translations[lang].region}: ${wine.Región}`"></p>
                                <p x-text="`${translations[lang].anada}: ${wine.Año}`"></p>
                                <p x-text="`${translations[lang].altura}: ${wine.Altura} msnm`"></p>
                                <p x-text="`${translations[lang].variedad}: ${wine.Variedad}`"></p>
                                <p x-text="wine.Descripción"></p>
                            </div>
                            <h3 x-text="wine.Nombre"></h3>
                            <p class="price" x-text="`${translations[lang].precio}: $${wine.Precio.toFixed(2)}`"></p>
                            <a class="buy-button" :href="wine.url || '#'">{{ translations[lang].viewDetails }}</a>
                        </div>
                    </template>
                </div>
                <p x-show="filteredWines.length === 0" class="error-message" x-text="translations[lang].noResults"></p>
                <p x-show="wines.length === 0 && showResults" class="error-message" x-text="translations[lang].errorLoading"></p>
            </div>
        </main>
    </div>
    <footer></footer>
</body>
</html>
